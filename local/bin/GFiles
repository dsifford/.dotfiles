#!/usr/bin/env bash
#
# Small helper command that is used in fzf.vim to show all git files with
# specific constraints described below.
#
set -e

# cd to git root or exit if not in a git repo
root_dir="$(git rev-parse --show-toplevel 2>/dev/null)"

comm -23 \
    <(
        # All files versioned in git
        #   INCLUDING untracked
        #   EXCLUDING gitignored files
        git ls-files -co --exclude-standard "$root_dir" | sort
     ) \
    <(
        # EXCLUDE from the above output..
        #   all tracked files that were deleted, whose deletion is currently
        #   untracked.
        git ls-files -d "$root_dir" | sort
    )
